## Introduction

<br>

- `async` 한정자는 비동기 프로그래밍을 쉽게 지원하기 위해 C# 5에 도입되었다.
- 메서드, 무명 메서드, 람다 식 등에 사용할 수 있으며, `await` 연산자와 함께 사용된다.
    - `async` 한정자는 로직 내에 `await` 연산자가 있다는 것을 컴파일러에 알려준다.
    - `await` 연산자는 지정한 작업이 끝날 때까지 호출자의 스레드가 블락되지 않고 기다릴 수 있게 해준다.
- `async` 한정자는 다음과 같은 리턴 형식을 가질 수 있다.
    - Task
    - Task<T>
    - void
        - `void`의 경우 이벤트 처리에만 사용한다. 일반적으로는 `Task`를 사용한다.

<br>

## Async 선언

<br>

- 기본적인 `async` 메서드는 아래와 같다.

```cs
// 리턴이 없는 메서드

async Task Foo()
{
    string a = await Bar();
    Console.WriteLine(a);
}
```

```cs
// 리턴이 있는 메서드

async Task<string> Foo()
{
    string a = await Bar();
    return a;
}
```

```cs
// void형

async void Foo()
{
    string a = await Bar();
    Console.WriteLine(a);
}
```

<br>

## Async, Await

<br>

- `async`, `await`을 메서드에 적용하면 제어는 다음과 같이 흐른다.

```cs
async static Task Main()
{
    // 호출자 thread
    string write = string.Empty;

    // worker thread
    Task<string> foo = Task.Run(() => Foo());

    // 호출자 thread
    Console.WriteLine("foo started");

    // 호출자 thread. Worker thread가 끝날 때까지 블락하지 않고 대기
    write = await foo;

    Console.WriteLine($"foo end - {write}");
}

async static Task<string> Foo()
{
    Trace.WriteLine("This is Foo");

    // 시간이 많이 걸리는 작업 가정
    await Task.Delay(100);

    return "Bar";
}

/* output:
foo started
This is Foo
foo end - Bar
```

- 위의 예제에서 `호출자 thread`에 주목할 필요가 있다.
- 사실상의 기능은 `await`에 있는데, 키워드를 만났을 때 `비동기식 대기`한 후 다시 `호출자 thread`로 제어권이 넘어온다.